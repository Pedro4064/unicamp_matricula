<!DOCTYPE html>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <meta charset="UTF-8">
    <title>PDF tables extractor</title>
    <style>
        td {
            white-space: pre;
        }
    </style>
</head>

<body>
    <a href="https://github.com/ronnywang/pdf-table-extractor"><img
            style="position: absolute; top: 0; right: 0; border: 0;"
            src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67"
            alt="Fork me on GitHub"
            data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>

    <h1>PDF tables extractor</h1>
    <p>Sample: <a href="samples/pta_10229_131308_94274.pdf">samples/pta_10229_131308_94274.pdf</a></p>
    <p>Sample: <a href="samples/rid-01.pdf">samples/rid-01.pdf</a></p>

    <div style="border:1px solid">
        <div id="drop">
            <span>Drop PDF file here</span>
        </div>
        <span>or click </span>
        <input type="file" id="pdf-file" />
        <label><input type="checkbox" name="merge-table">Merge table</label>
        <label><input type="checkbox" name="merge-table-remove-first-line">Merge table and remove first line</label>
    </div>

    <h2>JSON Result</h2>
    <textarea id="json-result" style="width: 100%; height: 200px"></textarea>
    <h2>CSV Result</h2>
    <select id="csv-select"></select>
    <textarea id="csv-result" style="width: 100%; height: 150px"></textarea>
    <h2>HTML Result:</h2>
    <div id="html-result">
    </div>

    <script src="build/pdf.js"></script>
    <script src="pdf-table-extractor.js"></script>
    <script id="script">
        var drop = document.getElementById('drop');
        function handleDrop(e) {
            $('#json-result').text('Transfering file...');
            e.stopPropagation();
            e.preventDefault();
            var files = e.dataTransfer.files;
            var f = files[0];
            {
                var reader = new FileReader();
                var name = f.name;
                reader.onload = function (e) {
                    var data = e.target.result;
                    $('#json-result').text('Parsing PDF...');
                    parse_content(data); //btoa(arr));
                };
                reader.readAsArrayBuffer(f);
            }
        }

        function handleFile(e) {
            $('#json-result').text('Transfering file...');
            var files = e.target.files;
            var f = files[0];
            {
                var reader = new FileReader();
                var name = f.name;
                reader.onload = function (e) {
                    var data = e.target.result;
                    $('#json-result').text('Parsing PDF...');
                    parse_content(data); //btoa(arr));
                };
                reader.readAsArrayBuffer(f);
            }
        }
        document.getElementById('pdf-file').addEventListener('change', handleFile, false);


        function handleDragover(e) {
            e.stopPropagation();
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
        }

        if (drop.addEventListener) {
            drop.addEventListener('dragenter', handleDragover, false);
            drop.addEventListener('dragover', handleDragover, false);
            drop.addEventListener('drop', handleDrop, false);
        }


        pdf_table_extractor_progress = function (result) {
            $('#json-result').text("Parsing PDF, progress: " + result.currentPages + " / " + result.numPages + " pages");
        };

        var parse_content = function (content) {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'build/pdf.worker.js';
            pdfjsLib.cMapUrl = 'https://mozilla.github.io/pdf.js/web/cmaps/';
            pdfjsLib.cMapPacked = true;

            var loadingTask = pdfjsLib.getDocument(content);

            loadingTask.promise.then(pdf_table_extractor).then(function (result) {
                // JSON output
                document.getElementById('json-result').innerText = JSON.stringify(result);
            });;
        };
    </script>